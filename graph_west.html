<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>West Coast Region - Performance Graph</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .header p {
            font-size: 1em;
            opacity: 0.9;
        }

        .controls {
            padding: 30px 40px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .controls h3 {
            margin-bottom: 15px;
            color: #667eea;
            font-size: 1.1em;
        }

        .location-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .checkbox-item:hover {
            background: #f0f0f0;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-item label {
            cursor: pointer;
            font-size: 0.9em;
            flex: 1;
        }

        .color-indicator {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid #ddd;
        }

        .button-group {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .chart-container {
            padding: 40px;
            position: relative;
            height: 600px;
        }

        .back-link {
            padding: 20px 40px;
            background: #f8f9fa;
        }

        .back-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            font-size: 1em;
        }

        .back-link a:hover {
            text-decoration: underline;
        }

        .rankings-section {
            padding: 40px;
            background: #f8f9fa;
            border-top: 2px solid #e9ecef;
        }

        .rankings-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .date-range-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            align-items: center;
            flex-wrap: wrap;
        }

        .date-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .date-input-group label {
            font-weight: 600;
            color: #667eea;
        }

        .date-input-group select {
            padding: 8px 12px;
            border: 2px solid #667eea;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .rankings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .ranking-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .ranking-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .ranking-list {
            list-style: none;
        }

        .ranking-list li {
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ranking-list li .rank {
            font-weight: 700;
            color: #667eea;
            margin-right: 10px;
            min-width: 25px;
        }

        .ranking-list li .location-name {
            flex: 1;
            font-weight: 500;
        }

        .ranking-list li .rating-value {
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
            min-width: 50px;
            text-align: center;
        }

        .rating-value.excellent {
            background: #d4edda;
            color: #28a745;
        }

        .rating-value.good {
            background: #e2e3e5;
            color: #5a6268;
        }

        .rating-value.fair {
            background: #fff3cd;
            color: #856404;
        }

        .rating-value.poor {
            background: #f8d7da;
            color: #721c24;
        }

        .rating-value.change {
            background: #cfe2ff;
            color: #084298;
        }

        .rating-value.positive {
            background: #d1e7dd;
            color: #0f5132;
        }

        .rating-value.negative {
            background: #f8d7da;
            color: #842029;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>West Coast Region - Performance Over Time</h1>
            <p style="font-size: 0.9em; margin-bottom: 5px; opacity: 0.85;">Created by Moiz Uddin</p>
            <p>Interactive Rating Trends</p>
        </div>

        <div class="controls">
            <h3>Select Locations to Display:</h3>
            <div class="location-checkboxes" id="locationCheckboxes"></div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="selectAll()">Select All</button>
                <button class="btn btn-secondary" onclick="deselectAll()">Deselect All</button>
                <button class="btn btn-primary" onclick="toggleAverage()">Toggle Average</button>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="performanceChart"></canvas>
        </div>

        
        <div class="rankings-section">
            <h2>Store Rankings</h2>
            <div class="date-range-selector">
                <div class="date-input-group">
                    <label for="startMonth">Start Month:</label>
                    <select id="startMonth" onchange="updateRankings()">
                    </select>
                    <select id="startYear" onchange="updateRankings()">
                    </select>
                </div>
                <div class="date-input-group">
                    <label for="endMonth">End Month:</label>
                    <select id="endMonth" onchange="updateRankings()">
                    </select>
                    <select id="endYear" onchange="updateRankings()">
                    </select>
                </div>
            </div>

            <div class="rankings-grid">
                <div class="ranking-card">
                    <h3>Best 5 Stores</h3>
                    <ul class="ranking-list" id="best5List"></ul>
                </div>
                <div class="ranking-card">
                    <h3>Worst 5 Stores</h3>
                    <ul class="ranking-list" id="worst5List"></ul>
                </div>
                <div class="ranking-card">
                    <h3>Most Improved</h3>
                    <ul class="ranking-list" id="improvedList"></ul>
                </div>
                <div class="ranking-card">
                    <h3>Most Declined</h3>
                    <ul class="ranking-list" id="declinedList"></ul>
                </div>
            </div>
                </div>

        <div class="back-link">
            <a href="index.html">‚Üê Back to Dashboard</a>
        </div>
    </div>

    <script>
        // Data for West Coast region
        const months = ["1/1/20", "2/1/20", "3/1/20", "4/1/20", "5/1/20", "6/1/20", "7/1/20", "8/1/20", "9/1/20", "10/1/20", "11/1/20", "12/1/20", "1/1/21", "2/1/21", "3/1/21", "4/1/21", "5/1/21", "6/1/21", "7/1/21", "8/1/21", "9/1/21", "10/1/21", "11/1/21", "12/1/21", "1/1/22", "2/1/22", "3/1/22", "4/1/22", "5/1/22", "6/1/22", "7/1/22", "8/1/22", "9/1/22", "10/1/22", "11/1/22", "12/1/22", "1/1/23", "2/1/23", "3/1/23", "4/1/23", "5/1/23", "6/1/23", "7/1/23", "8/1/23", "9/1/23", "10/1/23", "11/1/23", "12/1/23", "1/1/24", "2/1/24", "3/1/24", "4/1/24", "5/1/24", "6/1/24", "7/1/24", "8/1/24", "9/1/24", "10/1/24", "11/1/24", "12/1/24", "1/1/25", "2/1/25", "3/1/25", "4/1/25", "5/1/25", "6/1/25", "7/1/25", "8/1/25", "9/1/25", "10/1/25"];

        const locations = [
            { name: '13428 Lincoln Way', city: 'Auburn', data: [2.7, 2.7, 2.7, 2.7, 2.7, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7], color: '#e74c3c' },
            { name: '785 Oak Grove Rd, #M', city: 'Concord', data: [2.4, 2.4, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.4, 2.3, 2.4, 2.4, 2.4, 2.5, 2.5, 2.6, 2.6, 2.6, 2.7, 2.6, 2.6, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.9, 2.9, 2.9, 2.9, 2.9, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 3.0, 3.1, 3.1, 3.1, 3.2, 3.2, 3.2, 3.1, 3.1], color: '#3498db' },
            { name: '2205 Sunset Blvd, Suite 501', city: 'Rocklin', data: [2.3, 2.3, 2.3, 2.4, 2.4, 2.4, 2.2, 2.3, 2.3, 2.3, 2.2, 2.1, 2.2, 2.1, 2.2, 2.3, 2.4, 2.4, 2.5, 2.4, 2.4, 2.3, 2.3, 2.4, 2.4, 2.3, 2.3, 2.3, 2.3, 2.2, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.4, 2.3, 2.3, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.5, 2.4, 2.4, 2.5, 2.6, 3.3, 3.4, 3.7, 3.8, 3.8, 3.9, 3.8, 3.8, 3.8], color: '#2ecc71' },
            { name: '2841 S El Camino Real', city: 'San Mateo', data: [2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.8, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.9, 2.9, 2.9, 2.8, 2.8, 2.8, 2.8, 2.9, 2.9, 2.9, 2.9, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 3.7, 4.1, 4.2, 4.3, 4.3, 4.4, 4.4, 4.4, 4.4], color: '#f39c12' },
            { name: '1031 Triangle Ct', city: 'West Sacramento', data: [2.9, 2.9, 2.9, 2.9, 2.8, 2.8, 2.8, 2.8, 2.8, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 3.1, 3.3, 3.4, 3.5, 3.6, 3.6, 3.6, 3.6, 3.6], color: '#9b59b6' },
            { name: '1861 E Gibson Road, Suite C', city: 'Woodland', data: [2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.6, 2.7, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.5, 2.5, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.4, 2.4, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.5, 2.4, 2.4, 2.4, 2.8, 3.0, 3.4, 3.5, 3.6, 3.7, 3.7, 3.7, 3.7], color: '#1abc9c' },
            { name: '711 Tank Farm Rd Suite 210 SMB', city: 'San Luis Obispo', data: [5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 4.8, 4.8, 4.8, 4.8, 4.8, 4.8, 4.8, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.9, 4.8, 4.8, 4.8, 4.8, 4.8, 4.8, 4.8, 4.8, 4.6, 4.6, 4.6, 4.6, 4.6, 4.6, 4.6, 4.6, 4.6, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.6, 4.5, 4.5, 4.5], color: '#34495e' },
            { name: '646 US-101', city: 'Depoe Bay', data: [2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.9, 2.9, 2.9, 2.9, 3.1, 3.3, 3.4, 3.4, 3.4, 3.4, 3.5, 3.5, 3.6], color: '#e67e22' },
            { name: '635 Ray J Glatt Circle B', city: 'Woodburn', data: [2.4, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.4, 2.4, 2.4, 2.5, 2.5, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.5, 2.5, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.5, 2.6, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6], color: '#95a5a6' },
            { name: '281 N 3rd Ave', city: 'Stayton', data: [2.1, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 1.9, 1.9, 1.9, 1.9, 1.9, 2.0, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 2.0, 2.2, 2.2, 2.2, 2.2, 2.4, 2.5, 2.5, 2.5], color: '#16a085' },
            { name: '36653 US-26', city: 'Sandy', data: [2.2, 2.2, 2.2, 2.2, 2.2, 2.1, 2.1, 2.1, 2.0, 2.0, 1.9, 1.9, 1.9, 2.0, 2.0, 1.9, 2.0, 2.1, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.2, 2.2, 2.2, 2.2, 2.2, 2.1, 2.1, 2.1, 2.1], color: '#c0392b' },
            { name: '385 NE Alsea HWY #6', city: 'Waldport', data: [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 4.0, 4.5, 4.5, 4.7, 3.8, 3.8, 3.8, 3.2, 3.2, 3.2, 3.2, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.1, 3.1, 3.4, 3.4, 3.4, 3.4, 3.4, 3.4, 3.2, 3.2, 3.2, 3.0, 3.0, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 4.1, 4.4, 4.6, 4.7, 4.7, 4.7, 4.7, 4.7, 4.7], color: '#27ae60' },
            { name: '353 NW 2nd Ave', city: 'Canby', data: [2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.2, 2.2, 2.2, 2.1, 2.1, 2.2, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.8, 2.9, 3.0, 3.1, 3.2, 3.2, 3.3, 3.3, 3.3], color: '#d35400' },
            { name: '430 S Bridge St', city: 'Sheridan', data: [2.8, 2.8, 2.8, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.6, 2.6, 2.6, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.6, 2.6, 2.6, 2.5, 2.6, 2.5, 2.4, 2.4, 2.4, 2.4, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5], color: '#8e44ad' },
            { name: '900 Lenora Street, Suite 140', city: 'Seattle', data: [1.0, 1.0, 1.9, 2.0, 2.0, 2.1, 1.8, 1.9, 1.9, 1.9, 2.0, 2.1, 2.2, 2.1, 2.1, 2.1, 2.1, 2.0, 2.1, 2.1, 2.1, 2.2, 2.1, 2.2, 2.2, 2.2, 2.2, 2.1, 2.1, 2.1, 2.1, 2.0, 2.0, 2.0, 2.0, 2.0, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.8, 1.8, 1.8, 1.9, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 1.8, 2.2, 2.5, 2.7, 2.7, 2.8, 2.9, 3.0, 3.2, 3.3], color: '#2980b9' },
            { name: '511 Morris St, Suite 2', city: 'La Conner', data: [2.0, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.8, 1.9, 1.9, 1.9, 1.9, 1.9, 1.8, 1.9, 2.0, 2.0, 2.0, 2.0, 2.1, 2.1, 2.1, 2.2, 2.2, 2.2, 2.1, 2.1, 2.1, 2.1, 2.1, 2.1, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.5, 2.7, 2.7, 2.8, 2.9, 2.9, 3.0, 3.2, 3.2], color: '#c0392b' },
            { name: '112 W 8th St', city: 'Port Angeles', data: [2.8, 2.8, 2.8, 2.8, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.6, 2.6, 2.6, 2.6, 2.6, 2.7, 2.7, 2.7, 2.8, 2.8, 2.8, 2.7, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.7, 2.8, 2.8, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.6, 2.6, 2.7, 2.7, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.5, 2.5, 2.5, 2.5, 2.6, 2.8, 2.9, 3.0, 3.0, 3.2, 3.4, 3.5, 3.5], color: '#16a085' },
            { name: '4519 SE Mile Hill Dr', city: 'Port Orchard', data: [2.8, 2.9, 2.8, 2.8, 2.8, 2.8, 2.8, 2.7, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.8, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.6, 2.7, 2.7, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.7, 2.8, 2.9, 2.9, 3.0, 3.0, 3.2, 3.2, 3.3], color: '#f1c40f' },
            { name: '1111 11th Ave', city: 'Longview', data: [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.9, 4.1, 4.1, 4.1, 4.2, 4.3], color: '#e74c3c' },
            { name: '1400 W Washington St #108', city: 'Sequim', data: [3.2, 3.2, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.0, 3.0, 3.0, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.1, 3.1, 3.1, 3.2, 3.2, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1, 3.0, 3.1, 3.1, 3.1, 3.1, 3.1, 3.1], color: '#3498db' },
            { name: '9300 271st St NW Suite B1', city: 'Stanwood', data: [2.2, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.3, 2.3, 2.2, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.4, 2.4, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.4, 2.4, 2.3, 2.3, 2.4, 2.4, 2.4, 2.4, 2.3, 2.3, 2.3, 2.3, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4, 2.0, 2.4, 2.4, 2.4, 2.4, 2.4, 2.4], color: '#2ecc71' }
        ];

        const average = {
            name: 'WEST AVERAGE',
            city: 'Average',
            data: [2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.6, 2.7, 2.6, 2.7, 2.7, 2.7, 2.7, 2.7, 2.7, 2.6, 2.6, 2.6, 2.6, 2.6, 2.7, 2.7, 2.7, 2.7, 2.6, 2.6, 2.7, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.6, 2.7, 2.7, 2.7, 2.7, 2.9, 3.1, 3.1, 3.2, 3.2, 3.3, 3.3, 3.3, 3.3],
            color: '#000000'
        };

        let chart;
        let showAverage = true;

        // Initialize checkboxes
        function initCheckboxes() {
            const container = document.getElementById('locationCheckboxes');
            locations.forEach((loc, index) => {
                const div = document.createElement('div');
                div.className = 'checkbox-item';
                div.innerHTML = `
                    <input type="checkbox" id="loc${index}" checked onchange="updateChart()">
                    <div class="color-indicator" style="background-color: ${loc.color}"></div>
                    <label for="loc${index}">${loc.city}</label>
                `;
                container.appendChild(div);
            });
        }

        // Initialize chart
        function initChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');

            const datasets = locations.map((loc, index) => ({
                label: loc.city,
                data: loc.data,
                borderColor: loc.color,
                backgroundColor: loc.color + '20',
                borderWidth: 2,
                tension: 0.4,
                pointRadius: 4,
                pointHoverRadius: 6
            }));

            // Add average dataset
            if (showAverage) {
                datasets.push({
                    label: average.name,
                    data: average.data,
                    borderColor: average.color,
                    backgroundColor: average.color + '20',
                    borderWidth: 4,
                    tension: 0.4,
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    borderDash: []
                });
            }

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            onClick: null,
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Google Reviews Rating Trends - West Coast Region',
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            padding: 20
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toFixed(1);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            min: 0.0,
                            max: 5.0,
                            ticks: {
                                stepSize: 0.5
                            },
                            title: {
                                display: true,
                                text: 'Rating',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Month',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }

        // Update chart based on selections
        function updateChart() {
            const datasets = [];

            locations.forEach((loc, index) => {
                const checkbox = document.getElementById('loc' + index);
                if (checkbox.checked) {
                    datasets.push({
                        label: loc.city,
                        data: loc.data,
                        borderColor: loc.color,
                        backgroundColor: loc.color + '20',
                        borderWidth: 2,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    });
                }
            });

            // Add average if enabled
            if (showAverage) {
                datasets.push({
                    label: average.name,
                    data: average.data,
                    borderColor: average.color,
                    backgroundColor: average.color + '20',
                    borderWidth: 4,
                    tension: 0.4,
                    pointRadius: 5,
                    pointHoverRadius: 7
                });
            }

            chart.data.datasets = datasets;
            chart.update();
        }

        // Select all locations
        function selectAll() {
            locations.forEach((loc, index) => {
                document.getElementById('loc' + index).checked = true;
            });
            updateChart();
        }

        // Deselect all locations
        function deselectAll() {
            locations.forEach((loc, index) => {
                document.getElementById('loc' + index).checked = false;
            });
            updateChart();
        }

        // Toggle average line
        function toggleAverage() {
            showAverage = !showAverage;
            updateChart();
        }

        // Initialize date selectors
        function initDateSelectors() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            const years = [2020, 2021, 2022, 2023, 2024, 2025];

            // Populate month dropdowns
            const startMonthSelect = document.getElementById('startMonth');
            const endMonthSelect = document.getElementById('endMonth');

            monthNames.forEach((month, index) => {
                startMonthSelect.add(new Option(month, index));
                endMonthSelect.add(new Option(month, index));
            });

            // Populate year dropdowns
            const startYearSelect = document.getElementById('startYear');
            const endYearSelect = document.getElementById('endYear');

            years.forEach(year => {
                startYearSelect.add(new Option(year, year));
                endYearSelect.add(new Option(year, year));
            });

            // Set default values (January 2020 to October 2025)
            startMonthSelect.value = 0;
            startYearSelect.value = 2020;
            endMonthSelect.value = 9; // October
            endYearSelect.value = 2025;
        }

        // Get month index from month/year
        function getMonthIndex(month, year) {
            return (year - 2020) * 12 + month;
        }

        // Calculate average rating for a range
        function calculateAverage(data, startIdx, endIdx) {
            let sum = 0;
            let count = 0;
            for (let i = startIdx; i <= endIdx && i < data.length; i++) {
                if (data[i] !== null && data[i] !== undefined) {
                    sum += data[i];
                    count++;
                }
            }
            return count > 0 ? sum / count : 0;
        }

        // Get rating class
        function getRatingClass(rating) {
            if (rating >= 4.0) return 'excellent';
            if (rating >= 3.0) return 'good';
            if (rating >= 2.5) return 'fair';
            return 'poor';
        }

        // Update rankings based on selected date range
        function updateRankings() {
            const startMonth = parseInt(document.getElementById('startMonth').value);
            const startYear = parseInt(document.getElementById('startYear').value);
            const endMonth = parseInt(document.getElementById('endMonth').value);
            const endYear = parseInt(document.getElementById('endYear').value);

            const startIdx = getMonthIndex(startMonth, startYear);
            const endIdx = getMonthIndex(endMonth, endYear);

            if (startIdx > endIdx) {
                alert('Start date must be before end date');
                return;
            }

            // Calculate metrics for each location
            const rankings = locations.map(loc => {
                const avgRating = calculateAverage(loc.data, startIdx, endIdx);
                const startRating = loc.data[startIdx] || 0;
                const endRating = loc.data[endIdx] || 0;
                const change = endRating - startRating;

                return {
                    name: loc.city,
                    avgRating: avgRating,
                    change: change,
                    startRating: startRating,
                    endRating: endRating
                };
            });

            // Best 5 (highest average)
            const best5 = [...rankings]
                .sort((a, b) => b.avgRating - a.avgRating)
                .slice(0, 5);

            // Worst 5 (lowest average)
            const worst5 = [...rankings]
                .sort((a, b) => a.avgRating - b.avgRating)
                .slice(0, 5);

            // Most Improved (highest positive change)
            const improved = [...rankings]
                .filter(item => item.change > 0)
                .sort((a, b) => b.change - a.change)
                .slice(0, 5);

            // Most Declined (highest negative change)
            const declined = [...rankings]
                .filter(item => item.change < 0)
                .sort((a, b) => a.change - b.change)
                .slice(0, 5);

            // Render lists
            renderRankingList('best5List', best5, 'avgRating');
            renderRankingList('worst5List', worst5, 'avgRating');
            renderRankingList('improvedList', improved, 'change');
            renderRankingList('declinedList', declined, 'change');
        }

        // Render a ranking list
        function renderRankingList(elementId, data, metric) {
            const listElement = document.getElementById(elementId);
            listElement.innerHTML = '';

            if (data.length === 0) {
                const li = document.createElement('li');
                li.style.justifyContent = 'center';
                li.style.fontStyle = 'italic';
                li.style.color = '#666';
                li.textContent = 'No data for selected date range';
                listElement.appendChild(li);
                return;
            }

            data.forEach((item, index) => {
                const li = document.createElement('li');

                const rankSpan = document.createElement('span');
                rankSpan.className = 'rank';
                rankSpan.textContent = `#${index + 1}`;

                const nameSpan = document.createElement('span');
                nameSpan.className = 'location-name';
                nameSpan.textContent = item.name;

                const valueSpan = document.createElement('span');
                valueSpan.className = 'rating-value';

                if (metric === 'avgRating') {
                    valueSpan.textContent = item.avgRating.toFixed(2);
                    valueSpan.classList.add(getRatingClass(item.avgRating));
                } else if (metric === 'change') {
                    const changeText = item.change >= 0 ? `+${item.change.toFixed(2)}` : item.change.toFixed(2);
                    valueSpan.textContent = changeText;
                    if (item.change > 0) {
                        valueSpan.classList.add('positive');
                    } else if (item.change < 0) {
                        valueSpan.classList.add('negative');
                    } else {
                        valueSpan.classList.add('change');
                    }
                }

                li.appendChild(rankSpan);
                li.appendChild(nameSpan);
                li.appendChild(valueSpan);
                listElement.appendChild(li);
            });
        }

        
        // Initialize on page load
        window.onload = function() {
            initCheckboxes();
            initChart();
            initDateSelectors();
            updateRankings();
        };
    </script>
</body>
</html>